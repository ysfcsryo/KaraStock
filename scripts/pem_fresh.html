<!DOCTYPE html>
<html lang="id" data-bs-theme="light">

<head>
    <title>Sistem Karawo - Decision Tree</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Sistem Prediksi Stok Penjualan berbasis Decision Tree untuk Karawo">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">

    <!-- Animate CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <!-- App CSS -->
    <link rel="stylesheet" href="http://127.0.0.1:8000/css/app.css">
</head>

<body>

    <div class="d-flex" id="wrapper">

        <div id="sidebar-wrapper">

            <div class="sidebar-header">

                <button id="sidebarToggle" title="Buka/Tutup Menu">
                    <i class="bi bi-list"></i>
                </button>

                <div class="brand-container">
                    <i class="bi bi-diagram-3 fs-4 me-2" style="color: var(--color-accent);"></i>
                    <div class="d-flex flex-column">
                        <span class="brand-text fw-bold fs-5">KaraStock</span>
                        <span class="small text-white-50">Decision Tree Stock Advisor</span>
                    </div>
                </div>

            </div>

            <div class="list-group list-group-flush mt-2">
                <a class="list-group-item list-group-item-action " href="http://127.0.0.1:8000">
                    <i class="bi bi-cloud-upload me-2"></i>
                    <span class="menu-text">Upload & Analisa</span>
                </a>

                <a class="list-group-item list-group-item-action " href="http://127.0.0.1:8000/hasil-analisa">
                    <i class="bi bi-bar-chart-fill me-2"></i>
                    <span class="menu-text">Hasil Analisa</span>
                </a>

                <a class="list-group-item list-group-item-action " href="http://127.0.0.1:8000/riwayat">
                    <i class="bi bi-clock-history me-2"></i>
                    <span class="menu-text">Riwayat Analisa</span>
                </a>
            </div>
        </div>

        <div id="page-content-wrapper">

            <div class="container-fluid px-4 pb-4 pt-4">
                                <div class="container-fluid px-0">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="fw-bold text-primary mb-1">
                <i class="bi bi-file-earmark-spreadsheet"></i> Pemrosesan File: test_data.csv
            </h4>
            <small class="text-muted">Total Data: 4 produk</small>
        </div>
        <a href="http://127.0.0.1:8000" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Kembali
        </a>
    </div>

    <!-- Tab Navigation -->
    <ul class="nav nav-tabs mb-4" id="pemrosesanTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="visualisasi-tab" data-bs-toggle="tab" data-bs-target="#visualisasi" type="button" role="tab">
                <i class="bi bi-diagram-3"></i> Visualisasi Decision Tree
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="entropy-tab" data-bs-toggle="tab" data-bs-target="#entropy" type="button" role="tab">
                <i class="bi bi-calculator"></i> Entropy & Information Gain
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="pemrosesanTabContent">
        <!-- Tab 1: Visualisasi Decision Tree -->
        <div class="tab-pane fade show active" id="visualisasi" role="tabpanel">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-diagram-3 text-primary"></i> Struktur Pohon Keputusan
                    </h5>
                </div>
                <div class="card-body" style="background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);">
                    <div class="tree-visualization-container">
                        <svg id="treeSvg" width="100%" height="600" style="min-height: 600px; border-bottom: 2px solid #e2e8f0; margin-bottom: 20px;"></svg>
                        <div id="treeTextView" style="margin-top: 20px;"></div>
                    </div>
                </div>

                <script>
                    const treeData = {"type":"root","label":"Root","total":4,"distribution":{"TINGKATKAN STOCK":2,"KURANGI STOCK":2},"entropy":1,"children":[{"type":"leaf","condition":"Terjual \u003E= 47.5","label":"TINGKATKAN STOCK","total":2,"distribution":{"TINGKATKAN STOCK":2},"entropy":0},{"type":"node","condition":"Terjual \u003C 47.5","label":"Node 2","total":2,"distribution":{"KURANGI STOCK":2},"entropy":0,"children":[{"type":"leaf","condition":"Lama Barang \u003E= ","label":"KURANGI STOCK","total":2,"distribution":{"KURANGI STOCK":2},"entropy":0},{"type":"leaf","condition":"Lama Barang \u003C ","label":"N\/A","total":0,"distribution":[],"entropy":0}]}]};

                    function drawTree() {
                        const svg = document.getElementById('treeSvg');
                        const svgWidth = Math.max(800, svg.parentElement.offsetWidth - 40);
                        const svgHeight = 700;

                        svg.setAttribute('width', svgWidth);
                        svg.setAttribute('height', svgHeight);
                        svg.innerHTML = '';

                        let nodeId = 0;
                        const nodePositions = new Map();

                        function calculatePositions(node, x, y, offsetX) {
                            const id = nodeId++;
                            nodePositions.set(id, {
                                x,
                                y,
                                node
                            });

                            const childCount = (node.children || []).length;
                            const verticalGap = 100;
                            const horizontalGap = offsetX;

                            if (childCount > 0) {
                                const totalWidth = childCount * horizontalGap;
                                const startX = x - (totalWidth / 2) + (horizontalGap / 2);

                                (node.children || []).forEach((child, idx) => {
                                    const childX = startX + (idx * horizontalGap);
                                    const childY = y + verticalGap;
                                    calculatePositions(child, childX, childY, horizontalGap * 0.7);
                                });
                            }

                            return id;
                        }

                        calculatePositions(treeData, svgWidth / 2, 40, 200);

                        // Draw connections
                        nodePositions.forEach((posData, id) => {
                            if (posData.node.children) {
                                posData.node.children.forEach(child => {
                                    const childPos = Array.from(nodePositions.values()).find(p => p.node === child);
                                    if (childPos) {
                                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                                        line.setAttribute('x1', posData.x);
                                        line.setAttribute('y1', posData.y + 35);
                                        line.setAttribute('x2', childPos.x);
                                        line.setAttribute('y2', childPos.y - 35);
                                        line.setAttribute('stroke', '#94a3b8');
                                        line.setAttribute('stroke-width', '2');
                                        line.setAttribute('stroke-dasharray', '0');
                                        svg.appendChild(line);
                                    }
                                });
                            }
                        });

                        // Draw nodes
                        nodePositions.forEach((posData, id) => {
                            const isLeaf = !posData.node.children || posData.node.children.length === 0;
                            const isRoot = posData.y < 50;

                            // Node circle background
                            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                            circle.setAttribute('cx', posData.x);
                            circle.setAttribute('cy', posData.y);
                            circle.setAttribute('r', '35');

                            if (isRoot) {
                                circle.setAttribute('fill', '#667eea');
                                circle.setAttribute('stroke', '#5568d3');
                            } else if (isLeaf) {
                                circle.setAttribute('fill', '#f5576c');
                                circle.setAttribute('stroke', '#d84456');
                            } else {
                                circle.setAttribute('fill', '#48bb78');
                                circle.setAttribute('stroke', '#38a169');
                            }

                            circle.setAttribute('stroke-width', '3');
                            svg.appendChild(circle);

                            // Node text
                            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                            text.setAttribute('x', posData.x);
                            text.setAttribute('y', posData.y);
                            text.setAttribute('text-anchor', 'middle');
                            text.setAttribute('dominant-baseline', 'middle');
                            text.setAttribute('fill', 'white');
                            text.setAttribute('font-weight', 'bold');
                            text.setAttribute('font-size', '11');
                            text.setAttribute('font-family', 'Segoe UI, sans-serif');
                            text.textContent = posData.node.label.substring(0, 15);
                            svg.appendChild(text);

                            // Condition label
                            if (posData.node.condition) {
                                const condText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                                condText.setAttribute('x', posData.x);
                                condText.setAttribute('y', posData.y + 50);
                                condText.setAttribute('text-anchor', 'middle');
                                condText.setAttribute('fill', '#64748b');
                                condText.setAttribute('font-size', '10');
                                condText.setAttribute('font-family', 'Segoe UI, sans-serif');
                                condText.textContent = posData.node.condition.substring(0, 20);
                                svg.appendChild(condText);
                            }

                            // Total data label
                            const totalText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                            totalText.setAttribute('x', posData.x);
                            totalText.setAttribute('y', posData.y + 65);
                            totalText.setAttribute('text-anchor', 'middle');
                            totalText.setAttribute('fill', '#94a3b8');
                            totalText.setAttribute('font-size', '9');
                            totalText.setAttribute('font-family', 'Segoe UI, sans-serif');
                            totalText.textContent = 'n=' + posData.node.total;
                            svg.appendChild(totalText);
                        });
                    }

                    // Draw text-based tree view
                    function drawTextTree() {
                        const container = document.getElementById('treeTextView');

                        function renderNode(node, level = 0) {
                            const indent = '&nbsp;&nbsp;&nbsp;'.repeat(level);
                            const isLeaf = !node.children || node.children.length === 0;
                            const isRoot = level === 0;

                            let icon = '◆ ';
                            if (isRoot) icon = '<span style="color: #667eea; font-size: 16px;">◆</span> ';
                            else if (isLeaf) icon = '<span style="color: #f5576c; font-size: 14px;">●</span> ';
                            else icon = '<span style="color: #48bb78; font-size: 15px;">▸</span> ';

                            let html = '<div style="margin-left: ' + (level * 30) + 'px; margin-bottom: 8px; line-height: 1.6;">';
                            html += icon;
                            html += '<span style="font-weight: bold; color: #1e293b;">' + node.label + '</span>';

                            if (node.condition) {
                                html += '<span style="color: #64748b; font-size: 12px; margin-left: 8px;">(' + node.condition + ')</span>';
                            }

                            if (isRoot) {
                                html += '<br><span style="color: #94a3b8; font-size: 11px; margin-left: 25px;">Total: ' + node.total + ' | Entropy: ' + Number(node.entropy).toFixed(3) + '</span>';
                            } else if (isLeaf) {
                                html += '<br><span style="color: #94a3b8; font-size: 11px; margin-left: 25px;">Data: ' + node.total + '</span>';
                            }

                            html += '</div>';

                            if (node.children) {
                                node.children.forEach(child => {
                                    html += renderNode(child, level + 1);
                                });
                            }

                            return html;
                        }

                        container.innerHTML = '<div style="font-family: \'Segoe UI\', sans-serif; color: #1e293b; padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #667eea;">' + renderNode(treeData) + '</div>';
                    }

                    // Initialize
                    window.addEventListener('load', function() {
                        setTimeout(() => {
                            drawTree();
                            drawTextTree();
                            window.addEventListener('resize', drawTree);
                        }, 100);
                    });

                    document.addEventListener('DOMContentLoaded', function() {
                        setTimeout(() => {
                            drawTree();
                            drawTextTree();
                        }, 100);
                    });
                </script>
            </div>
        </div>

        <!-- Tab 2: Entropy & Information Gain -->
        <div class="tab-pane fade" id="entropy" role="tabpanel">
            <div class="card shadow-sm border-0 mb-3">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-calculator text-success"></i> Perhitungan Entropy & Information Gain
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Entropy Root -->
                    <div class="mb-4 p-3 bg-light rounded">
                        <h6 class="fw-bold mb-3">
                            <i class="bi bi-circle-fill text-primary"></i> Entropy Root (Entropy Keseluruhan)
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-2"><strong>Total Data:</strong> 4</p>
                                <p class="mb-2"><strong>Distribusi Label:</strong></p>
                                <ul class="list-unstyled ms-3">
                                                                        <li>
                                        <span class="badge bg-secondary me-2">TINGKATKAN STOCK</span>
                                        : 2 data (50%)
                                    </li>
                                                                        <li>
                                        <span class="badge bg-secondary me-2">KURANGI STOCK</span>
                                        : 2 data (50%)
                                    </li>
                                                                    </ul>
                            </div>
                            <div class="col-md-6">
                                <div class="p-3 bg-white border rounded">
                                    <p class="mb-1 text-muted small">Entropy Root</p>
                                    <h3 class="mb-0 text-primary fw-bold">1</h3>
                                    <small class="text-muted">Formula: -Σ(p × log₂(p))</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Information Gain untuk setiap Split -->
                    <h6 class="fw-bold mb-3">
                        <i class="bi bi-arrow-down-circle text-success"></i> Information Gain untuk Setiap Split
                    </h6>
                    
                    <!-- Root Level Splits -->
                    <div class="mb-4 p-3 bg-info-subtle rounded">
                        <h6 class="fw-bold text-info mb-3">
                            <i class="bi bi-diagram-3"></i> Level 1: Root Splits (Candidate untuk Root Node)
                        </h6>
                                                <div class="card mb-3 border">
                            <div class="card-header bg-light">
                                <h6 class="mb-0 fw-semibold">
                                    Candidate 1: Terjual
                                    <span class="badge bg-primary">Terjual >= 47.5</span>
                                                                        <span class="badge bg-success">✓ DIPILIH SEBAGAI ROOT</span>
                                                                    </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="fw-bold text-success">Left Branch (Terjual < 47.5)</h6>
                                        <p class="mb-1"><strong>Jumlah Data:</strong> 2</p>
                                        <p class="mb-1"><strong>Distribusi:</strong></p>
                                        <ul class="list-unstyled ms-3 mb-2">
                                                                                        <li>
                                                <span class="badge bg-secondary me-1">KURANGI STOCK</span>
                                                : 2
                                            </li>
                                                                                    </ul>
                                        <p class="mb-0"><strong>Entropy:</strong> <span class="text-success fw-bold">0</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="fw-bold text-primary">Right Branch (Terjual >= 47.5)</h6>
                                        <p class="mb-1"><strong>Jumlah Data:</strong> 2</p>
                                        <p class="mb-1"><strong>Distribusi:</strong></p>
                                        <ul class="list-unstyled ms-3 mb-2">
                                                                                        <li>
                                                <span class="badge bg-secondary me-1">TINGKATKAN STOCK</span>
                                                : 2
                                            </li>
                                                                                    </ul>
                                        <p class="mb-0"><strong>Entropy:</strong> <span class="text-primary fw-bold">0</span></p>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Weighted Entropy:</strong></p>
                                        <p class="mb-0 text-muted small">
                                            (2/4) × 0 +
                                            (2/4) × 0
                                            = <strong>0</strong>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="p-3 bg-success-subtle border border-success rounded">
                                            <p class="mb-1 text-muted small">Information Gain</p>
                                            <h4 class="mb-0 text-success fw-bold">
                                                1
                                            </h4>
                                            <small class="text-muted">
                                                Formula: Entropy Root - Weighted Entropy
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                                                <div class="card mb-3 border">
                            <div class="card-header bg-light">
                                <h6 class="mb-0 fw-semibold">
                                    Candidate 2: Lama Barang
                                    <span class="badge bg-primary">Lama Barang >= 35</span>
                                                                    </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="fw-bold text-success">Left Branch (Lama Barang < 35)</h6>
                                        <p class="mb-1"><strong>Jumlah Data:</strong> 2</p>
                                        <p class="mb-1"><strong>Distribusi:</strong></p>
                                        <ul class="list-unstyled ms-3 mb-2">
                                                                                        <li>
                                                <span class="badge bg-secondary me-1">TINGKATKAN STOCK</span>
                                                : 2
                                            </li>
                                                                                    </ul>
                                        <p class="mb-0"><strong>Entropy:</strong> <span class="text-success fw-bold">0</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="fw-bold text-primary">Right Branch (Lama Barang >= 35)</h6>
                                        <p class="mb-1"><strong>Jumlah Data:</strong> 2</p>
                                        <p class="mb-1"><strong>Distribusi:</strong></p>
                                        <ul class="list-unstyled ms-3 mb-2">
                                                                                        <li>
                                                <span class="badge bg-secondary me-1">KURANGI STOCK</span>
                                                : 2
                                            </li>
                                                                                    </ul>
                                        <p class="mb-0"><strong>Entropy:</strong> <span class="text-primary fw-bold">0</span></p>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Weighted Entropy:</strong></p>
                                        <p class="mb-0 text-muted small">
                                            (2/4) × 0 +
                                            (2/4) × 0
                                            = <strong>0</strong>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="p-3 bg-success-subtle border border-success rounded">
                                            <p class="mb-1 text-muted small">Information Gain</p>
                                            <h4 class="mb-0 text-success fw-bold">
                                                1
                                            </h4>
                                            <small class="text-muted">
                                                Formula: Entropy Root - Weighted Entropy
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                                            </div>

                    <!-- Level-2 Splits -->
                                        <div class="mb-4 p-3 bg-warning-subtle rounded">
                        <h6 class="fw-bold text-warning mb-3">
                            <i class="bi bi-diagram-2"></i> Level 2: Sub-Node Splits (Pada Left Subset)
                        </h6>
                                                <div class="card mb-3 border">
                            <div class="card-header bg-light">
                                <h6 class="mb-0 fw-semibold">
                                    Sub-Split 1: Lama Barang
                                    <span class="badge bg-warning">Lama Barang >= </span>
                                    <br>
                                    <small class="text-muted">Parent Condition: Terjual &lt; 47.5</small>
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="fw-bold text-success">Left Branch (Lama Barang < )</h6>
                                        <p class="mb-1"><strong>Jumlah Data:</strong> 0</p>
                                        <p class="mb-1"><strong>Distribusi:</strong></p>
                                        <ul class="list-unstyled ms-3 mb-2">
                                                                                    </ul>
                                        <p class="mb-0"><strong>Entropy:</strong> <span class="text-success fw-bold">0</span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="fw-bold text-primary">Right Branch (Lama Barang >= )</h6>
                                        <p class="mb-1"><strong>Jumlah Data:</strong> 0</p>
                                        <p class="mb-1"><strong>Distribusi:</strong></p>
                                        <ul class="list-unstyled ms-3 mb-2">
                                                                                    </ul>
                                        <p class="mb-0"><strong>Entropy:</strong> <span class="text-primary fw-bold">0</span></p>
                                    </div>
                                </div>
                                <hr>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <p class="mb-1"><strong>Weighted Entropy:</strong></p>
                                        <p class="mb-0 text-muted small">
                                            (0/0) × 0 +
                                            (0/0) × 0
                                            = <strong></strong>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="p-3 bg-warning-subtle border border-warning rounded">
                                            <p class="mb-1 text-muted small">Information Gain</p>
                                            <h4 class="mb-0 text-warning fw-bold">
                                                0
                                            </h4>
                                            <small class="text-muted">
                                                Formula: Entropy(Parent) - Weighted Entropy
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                                            </div>
                                    </div>
            </div>
        </div>
    </div>
</div>

            </div>

            <footer class="text-center text-muted small pb-3 mt-2">
                &copy; 2025 KaraStock · <span style="color: var(--color-primary);">Decision Support System</span>
            </footer>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', event => {
            const sidebarToggle = document.body.querySelector('#sidebarToggle');
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', event => {
                    event.preventDefault();
                    document.body.classList.toggle('sb-sidenav-toggled');
                });
            }
        });
    </script>

    
</body>

</html>